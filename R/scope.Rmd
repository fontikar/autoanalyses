---
title: "Scoping for Automated Analyses in R"
date: "`r Sys.Date()`"
author: Fonti Kar
---

```{r, include=FALSE}
install.packages("pacman")
pacman::p_load(tidyverse, usethis)
```


## Goal

Using R to do "automatic analyses" with minimal input (or knowledge) from the user. Likely to have a natural language interface with the user (though probably the NL part can be ignored for now). 

Some examples: 

- the user might type in "Are X and Y the same?" or "Are X and Y related?"
- "Do X and Y have the same distribution" or "Do X and Y have different means?".

There are lots of statistical tests and modelling that an expert might then go through to come up with an answer that can then be reported back to the user. The idea is to figure out a framework that the "autonomous analyst" could do all of this (in a smart way) in the background, very quickly, and then give the result (in plain language) back to the user. I'm looking to get more substantial funding to develop this in the future, but a small pilot study under your current role could be very helpful, especially given your expertise in R. The pilot study could even just be brainstorming how it might work as a software product.

## Assumptions

Advances in GPT models and capabilities
3, 4, 5 release and how it addresses needs in goal

My assumption is to rely on GPT's NLP interface and this product and wrap around it

## Review of Existing products

### OpenAI API key

Many tools that uses the GPT models requires an API key. To request for one, you will first need to [sign up](https://platform.openai.com/signup?launch) for an account.

Once you have logged in, you can [create API keys](https://platform.openai.com/account/api-keys) under the user menu. 

Add the OpenAI API key in R in your global environment using the following. Note that you will need to restart your R/RStudio for the changes to take effect

```{r, eval=FALSE}
install.packages("usethis")
usethis::edit_r_environ()

# Paste your key in the .Renviron file using the format
# OPENAI_API_KEY="your-unique-api-key"
```

To call your API key:

```{r}
Sys.getenv("OPENAI_API_KEY")
```

### OpenAir

Looks like a simply wrapper around ChatGPT where you can prompt the model in the console

[Documentation](https://umatter.github.io/OpenAIR/)
[GitHub](https://github.com/umatter/OpenAIR)

#### Installation 

```{r, eval=FALSE}
#install.packages("remotes")
remotes::install_github("umatter/OpenAIR")
```

#### Demonstration

```{r}
library(TheOpenAIR)

chat("What is a R package?")
```

#### Evaluation

Strengths:

Caveats: Currently not running ðŸ˜… I think you need a paid account for OpenAI


### RTutor

RTutor is an AI-based app that can quickly generate and test R code. Powered by API calls to OpenAI's Davinci (ChatGPT's sibling), RTutor translates natural languages into R scripts, which are then executed within the Shiny platform. An R Markdown source file and HTML report can be generated.

[RTutor app](https://rtutor.ai/)
[Source code](https://github.com/gexijin/RTutor)

```{r, eval=FALSE}
remotes::install_github("gexijin/RTutor")
```

#### Demonstration

```{r, eval=FALSE}
library(RTutor)

RTutor::run_app()
```

> Prompt: Is height and age related?

Using the Loblolly example dataset

```{r}
# Load required library
library(dplyr)

# Filter the data frame to include only the relevant columns
df_filtered <- df %>% select(height, age)

# Convert the height column to numeric
df_filtered$height <- as.numeric(as.character(df_filtered$height))

# Calculate the correlation coefficient between height and age
correlation <- cor(df_filtered$height, as.numeric(as.character(df_filtered$age)))

# Print the correlation coefficient
print(correlation)

# 0.9899132
```

> Prompt: Does height and age come from the same distribution?

```{r}
# Load required library
library(dplyr)
library(ggplot2)

# Filter the data frame to include only the relevant columns
df_filtered <- df %>% select(height, age)

# Convert the height and age columns to numeric
df_filtered$height <- as.numeric(as.character(df_filtered$height))
df_filtered$age <- as.numeric(as.character(df_filtered$age))

# Perform a two-sample t-test to compare the means of height and age
t_test <- t.test(df_filtered$height, df_filtered$age)

# Print the p-value from the t-test
print(t_test$p.value)

# 1.456461e-12
```

#### Evaluation

Strengths: Pretty responsive, works well with example datasets

Caveats: 

- The 'Ask' tool is not working: API connection error
- Some code is a little unneccessary e.g. `as.numeric(as.character(df_filtered$age)))`.
- Responds in R code, no natural language reply, embedded in R code comments e.g.

`# Interpret the p-value
if (p_value < 0.05) {
  interpretation <- "The p-value is less than 0.05, indicating strong evidence against the null hypothesis."
} else {
  interpretation <- "The p-value is greater than or equal to 0.05, indicating weak evidence against the null hypothesis."
}
`

### Chatlize.ai

A "general data science platform" but almost exactly the same as RTutor. A shiny wrapper around OpenAI API. User must upload data. Same developer as RTutor. Source code not found.

[Chatlize.ai app](https://chatlize.ai/)


#### Demonstration

I uploaded the Loblolly data as a .csv and asked:
> Prompt: Is height and age related?

```{r}
# Load required library
pacman::p_load(ggplot2)

# Create a dataframe with height and age values
data <- data.frame(height = c(155, 165, 170, 175, 180, 185, 190),
                   age = c(20, 25, 30, 35, 40, 45, 50))

# Calculate the correlation coefficient between height and age
cor(data$height, data$age)
```

> Prompt: Does height and age come from the same distribution?

```{r}
# Load required library
pacman::p_load(ggplot2)

# Create a dataframe with height and age values
data <- data.frame(height = c(155, 165, 170, 175, 180, 185, 190),
                   age = c(20, 25, 30, 35, 40, 45, 50))

# Perform a two-sample t-test to compare the height and age distributions
t.test(data$height, data$age)
```

#### Evaluation

Strengths: 

Caveats: 

- Not intuitive interface
- Replies in code
- Loads unnecessary libraries

### askgpt

#### Installation

```{r}
install.packages("askgpt")
```

#### Demonstration

```{r}
library(askgpt)

login()

askgpt("What is a R package")
```

#### Evaluation

Strengths: Easy to use and understand and better error handling than OpenAir, Add ins from toolbar (CMD/CTRL+SHIFT+P. Type in gpt and it can annotate code/write tests etc)

Caveats: Not analytical or statistical per se but actually more for R package development

## gptstudio

RStudio plugin + Shiny interface to ChatGPT 

[Website](https://michelnivard.github.io/gptstudio/)
[Source code](https://github.com/MichelNivard/gptstudio)

#### Installation

```{r}
install.packages("gptstudio")
```

#### Demonstration

Once installed, click ChatGPT and Shiny interface will come up - ask away! 

> How do I interpet a P value of 0.008?

Crashes

#### Evaluation

Strengths: 

- Can set tidyverse style, whether or not usre is a beginner, different API's e.g.
- Nice interface
- Runs as a background job too - so frees up console
- Different language support
