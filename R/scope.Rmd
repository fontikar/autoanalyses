---
title: "Scoping for Automated Analyses in R"
date: "`r Sys.Date()`"
author: Fonti Kar
---

```{r, include=FALSE}
install.packages("pacman")
pacman::p_load(tidyverse, usethis)
```


## Goal

Using R to do "automatic analyses" with minimal input (or knowledge) from the user. Likely to have a natural language interface with the user (though probably the NL part can be ignored for now). 

Some examples: 

- the user might type in "Are X and Y the same?" or "Are X and Y related?"
- "Do X and Y have the same distribution" or "Do X and Y have different means?".

There are lots of statistical tests and modelling that an expert might then go through to come up with an answer that can then be reported back to the user. The idea is to figure out a framework that the "autonomous analyst" could do all of this (in a smart way) in the background, very quickly, and then give the result (in plain language) back to the user. I'm looking to get more substantial funding to develop this in the future, but a small pilot study under your current role could be very helpful, especially given your expertise in R. The pilot study could even just be brainstorming how it might work as a software product.

## Assumptions

Advances in GPT models and capabilities
3, 4, 5 release and how it addresses needs in goal

My assumption is to rely on GPT's NLP interface and this product and wrap around it

### Demo data

```{r}
demo_data <- tibble(x = rnorm(n = 50, mean = 5, sd = 0.2),
       y = rnorm(n = 50, mean = 2, sd = 1)
)
```

## Review of Existing products

### OpenAI API key

Many tools that uses the GPT models requires an API key. To request for one, you will first need to [sign up](https://platform.openai.com/signup?launch) for an account.

Once you have logged in, you can [create API keys](https://platform.openai.com/account/api-keys) under the user menu. 

Add the OpenAI API key in R in your global environment using the following. Note that you will need to restart your R/RStudio for the changes to take effect

```{r, eval=FALSE}
install.packages("usethis")
usethis::edit_r_environ()

# Paste your key in the .Renviron file using the format
# OPENAI_API_KEY="your-unique-api-key"
```

To call your API key:

```{r}
Sys.getenv("OPENAI_API_KEY")
```

### OpenAir

Looks like a simply wrapper around ChatGPT where you can prompt the model in the console

[Documentation](https://umatter.github.io/OpenAIR/)
[GitHub](https://github.com/umatter/OpenAIR)

#### Installation 

```{r, eval=FALSE}
#install.packages("remotes")
remotes::install_github("umatter/OpenAIR")
```

#### Demonstration

```{r}
library(TheOpenAIR)

openai_api_key(Sys.getenv("OPENAI_API_KEY"))

chat("What is a R package?")
```

#### Evaluation

Strengths:

Caveats: Currently not running ðŸ˜…


### RTutor

Shiny wrapper around OpenAI. Voice enabled as an option

[RTutor app](https://rtutor.ai/)
[Source code](https://github.com/gexijin/RTutor)

```{r, eval=FALSE}
remotes::install_github("gexijin/RTutor")
```

#### Demonstration

```{r, eval=FALSE}
library(RTutor)

RTutor::run_app()
```

Prompt: Does height and age come from the same distribution?

Using the Loblolly example dataset

```{r}
# Load required library
library(dplyr)

# Filter the data frame to include only the relevant columns
df_filtered <- df %>% select(height, age)

# Convert the height column to numeric
df_filtered$height <- as.numeric(as.character(df_filtered$height))

# Calculate the correlation coefficient between height and age
correlation <- cor(df_filtered$height, as.numeric(as.character(df_filtered$age)))

# Print the correlation coefficient
print(correlation)

# 0.9899132
```

Prompt: Does height and age come from the same distribution?

```{r}
# Load required library
library(dplyr)
library(ggplot2)

# Filter the data frame to include only the relevant columns
df_filtered <- df %>% select(height, age)

# Convert the height and age columns to numeric
df_filtered$height <- as.numeric(as.character(df_filtered$height))
df_filtered$age <- as.numeric(as.character(df_filtered$age))

# Perform a two-sample t-test to compare the means of height and age
t_test <- t.test(df_filtered$height, df_filtered$age)

# Print the p-value from the t-test
print(t_test$p.value)

# 1.456461e-12
```

#### Evaluation

Strengths: Pretty responsive, works well with example datasets

Caveats: The 'Ask' tool is not working: API connection error


### Chatlize.ai

https://chatlize.ai/